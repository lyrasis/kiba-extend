<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: Kiba::Extend::Sources::JsonDir
  
    &mdash; Kiba-Extend Documentation
  
</title>

  <link rel="stylesheet" href="../../../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../../../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Kiba::Extend::Sources::JsonDir";
  relpath = '../../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../../_index.html">Index (J)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../../Kiba.html" title="Kiba (module)">Kiba</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../../Extend.html" title="Kiba::Extend (module)">Extend</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Sources.html" title="Kiba::Extend::Sources (module)">Sources</a></span></span>
     &raquo; 
    <span class="title">JsonDir</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: Kiba::Extend::Sources::JsonDir
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Kiba::Extend::Sources::JsonDir</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  <dl>
      <dt>Extended by:</dt>
      <dd><span class='object_link'><a href="Sourceable.html" title="Kiba::Extend::Sources::Sourceable (module)">Sourceable</a></span></dd>
  </dl>
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/kiba/extend/sources/json_dir.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'><p>May return Hashes having different keys, which will cause problems
writing out to <span class='object_link'><a href="../Destinations/CSV.html" title="Kiba::Extend::Destinations::CSV (class)">Destinations::CSV</a></span>, which expects all
rows to have the same headers/fields. Using
<span class='object_link'><a href="../Transforms/Clean/EnsureConsistentFields.html" title="Kiba::Extend::Transforms::Clean::EnsureConsistentFields (class)">Transforms::Clean::EnsureConsistentFields</a></span> in any job
that has a <span class='object_link'><a href="" title="Kiba::Extend::Sources::JsonDir (class)">JsonDir</a></span> source and a <span class='object_link'><a href="../Destinations/CSV.html" title="Kiba::Extend::Destinations::CSV (class)">Destinations::CSV</a></span>
destination will protect against these errors.
<span class='object_link'><a href="../Jobs/JsonToCsvJob.html" title="Kiba::Extend::Jobs::JsonToCsvJob (class)">Jobs::JsonToCsvJob</a></span> runs this transform automatically
as the last step before writing out rows</p>
</div>
  </div>

<p>Given path to a directory, JSON parses each file matching given
  specifications, and returns the result as a Hash with:</p>

<ul>
<li>empty values converted to <code>nil</code></li>
<li>keys downcased and converted to Symbols</li>
</ul>

<p>Nothing is done to handle non-String data structures as the values
  of top-level keys in the JSON documents. If using CSV destination,
  such values are written out as text string versions of their Ruby
  representations. That is, your CSV field value might be:</p>

<p>rubocop:todo Layout/LineLength
<code>{&quot;65&quot;=&gt;{&quot;title&quot;=&gt;&quot;C1&quot;, &quot;file&quot;=&gt;&quot;66.jp2&quot;}, &quot;67&quot;=&gt;{&quot;title&quot;=&gt;&quot;C2&quot;, &quot;file&quot;=&gt;&quot;67.jp2&quot;}}</code>
rubocop:enable Layout/LineLength</p>

<p>If you need to work with such a value in subsequent jobs (i.e. reading
  the string back in from the CSV), you can do something like:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_transform'>transform</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_row'>row</span><span class='op'>|</span>
  <span class='id identifier rubyid_val'>val</span> <span class='op'>=</span> <span class='id identifier rubyid_row'>row</span><span class='lbracket'>[</span><span class='symbol'>:codestringfield</span><span class='rbracket'>]</span>
  <span class='kw'>next</span> <span class='id identifier rubyid_row'>row</span> <span class='kw'>if</span> <span class='id identifier rubyid_val'>val</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>

  <span class='comment'># Given the example above, this will convert `val` to a Ruby Hash
</span>  <span class='id identifier rubyid_code'>code</span> <span class='op'>=</span> <span class='id identifier rubyid_instance_eval'>instance_eval</span><span class='lparen'>(</span><span class='id identifier rubyid_val'>val</span><span class='rparen'>)</span>
  <span class='comment'># whatever additional code you need to process the data
</span>  <span class='id identifier rubyid_row'>row</span>
<span class='kw'>end</span>
</code></pre>


  </div>
</div>
<div class="tags">
  

</div>






  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#default_file_options-class_method" title="default_file_options (class method)">.<strong>default_file_options</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#options_key-class_method" title="options_key (class method)">.<strong>options_key</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#path_key-class_method" title="path_key (class method)">.<strong>path_key</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#requires_path%3F-class_method" title="requires_path? (class method)">.<strong>requires_path?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#each-instance_method" title="#each (instance method)">#<strong>each</strong> {|jsonhash| ... } &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(dirpath:, recursive: false, filesuffixes: [&quot;.json&quot;])  &#x21d2; JsonDir </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>A new instance of JsonDir.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Sourceable.html" title="Kiba::Extend::Sources::Sourceable (module)">Sourceable</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Sourceable.html#is_source%3F-instance_method" title="Kiba::Extend::Sources::Sourceable#is_source? (method)">is_source?</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../Registry/Fileable.html" title="Kiba::Extend::Registry::Fileable (module)">Registry::Fileable</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Registry/Fileable.html#default_args-instance_method" title="Kiba::Extend::Registry::Fileable#default_args (method)">#default_args</a></span>, <span class='object_link'><a href="../Registry/Fileable.html#default_file_options-instance_method" title="Kiba::Extend::Registry::Fileable#default_file_options (method)">#default_file_options</a></span>, <span class='object_link'><a href="../Registry/Fileable.html#labeled_options-instance_method" title="Kiba::Extend::Registry::Fileable#labeled_options (method)">#labeled_options</a></span>, <span class='object_link'><a href="../Registry/Fileable.html#options_key-instance_method" title="Kiba::Extend::Registry::Fileable#options_key (method)">#options_key</a></span>, <span class='object_link'><a href="../Registry/Fileable.html#path_key-instance_method" title="Kiba::Extend::Registry::Fileable#path_key (method)">#path_key</a></span>, <span class='object_link'><a href="../Registry/Fileable.html#requires_path%3F-instance_method" title="Kiba::Extend::Registry::Fileable#requires_path? (method)">#requires_path?</a></span></p>
<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>(dirpath:, recursive: false, filesuffixes: [&quot;.json&quot;])  &#x21d2; <tt><span class='object_link'><a href="" title="Kiba::Extend::Sources::JsonDir (class)">JsonDir</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns a new instance of JsonDir.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>dirpath</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>path of directory containing JSON files</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>recursive</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>false</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>Whether to include eligible JSON
files in subdirectories</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>filesuffixes</span>
      
      
        <span class='type'>(<tt>Array&lt;String&gt;</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>[&quot;.json&quot;]</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>to read in as
JSON records. Include preceding period</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


73
74
75
76
77</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/kiba/extend/sources/json_dir.rb', line 73</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='label'>dirpath:</span><span class='comma'>,</span> <span class='label'>recursive:</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='label'>filesuffixes:</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>.json</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='ivar'>@path</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_expand_path'>expand_path</span><span class='lparen'>(</span><span class='id identifier rubyid_dirpath'>dirpath</span><span class='rparen'>)</span>
  <span class='ivar'>@recursive</span> <span class='op'>=</span> <span class='id identifier rubyid_recursive'>recursive</span>
  <span class='ivar'>@filesuffixes</span> <span class='op'>=</span> <span class='id identifier rubyid_filesuffixes'>filesuffixes</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="default_file_options-class_method">
  
    .<strong>default_file_options</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


51
52
53</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/kiba/extend/sources/json_dir.rb', line 51</span>

<span class='kw'>def</span> <span class='id identifier rubyid_default_file_options'>default_file_options</span>
  <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="options_key-class_method">
  
    .<strong>options_key</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


55
56
57</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/kiba/extend/sources/json_dir.rb', line 55</span>

<span class='kw'>def</span> <span class='id identifier rubyid_options_key'>options_key</span>
  <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="path_key-class_method">
  
    .<strong>path_key</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


59
60
61</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/kiba/extend/sources/json_dir.rb', line 59</span>

<span class='kw'>def</span> <span class='id identifier rubyid_path_key'>path_key</span>
  <span class='symbol'>:dirpath</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="requires_path?-class_method">
  
    .<strong>requires_path?</strong>  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


63
64
65</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/kiba/extend/sources/json_dir.rb', line 63</span>

<span class='kw'>def</span> <span class='id identifier rubyid_requires_path?'>requires_path?</span>
  <span class='kw'>true</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="each-instance_method">
  
    #<strong>each</strong> {|jsonhash| ... } &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'><p>If a file cannot be read/parsed as JSON, no Hash is yielded
and a warning is written to STDOUT</p>
</div>
  </div>



  </div>
</div>
<div class="tags">
  
<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>jsonhash</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>of parsed JSON</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


82
83
84
85
86
87
88
89
90
91</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/kiba/extend/sources/json_dir.rb', line 82</span>

<span class='kw'>def</span> <span class='id identifier rubyid_each'>each</span>
  <span class='id identifier rubyid_file_list'>file_list</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_path'>path</span><span class='op'>|</span>
    <span class='id identifier rubyid_jsonhash'>jsonhash</span> <span class='op'>=</span> <span class='id identifier rubyid_parse_json'>parse_json</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_jsonhash'>jsonhash</span>
      <span class='kw'>yield</span> <span class='id identifier rubyid_jsonhash'>jsonhash</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_warn'>warn</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Cannot read/parse </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_path'>path</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Sun Aug 27 01:12:08 2023 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.34 (ruby-2.7.8).
</div>

    </div>
  </body>
</html>