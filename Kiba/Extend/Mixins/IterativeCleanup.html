<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Module: Kiba::Extend::Mixins::IterativeCleanup
  
    &mdash; Kiba-Extend Documentation
  
</title>

  <link rel="stylesheet" href="../../../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../../../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Kiba::Extend::Mixins::IterativeCleanup";
  relpath = '../../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../../_index.html">Index (I)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../../Kiba.html" title="Kiba (module)">Kiba</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../../Extend.html" title="Kiba::Extend (module)">Extend</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Mixins.html" title="Kiba::Extend::Mixins (module)">Mixins</a></span></span>
     &raquo; 
    <span class="title">IterativeCleanup</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Module: Kiba::Extend::Mixins::IterativeCleanup
  
  
  
</h1>
<div class="box_info">
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/kiba/extend/mixins/iterative_cleanup.rb<span class="defines">,<br />
  lib/kiba/extend/mixins/iterative_cleanup/jobs.rb,<br /> lib/kiba/extend/mixins/iterative_cleanup/jobs/final.rb,<br /> lib/kiba/extend/mixins/iterative_cleanup/jobs/worksheet.rb,<br /> lib/kiba/extend/mixins/iterative_cleanup/jobs/corrections.rb,<br /> lib/kiba/extend/mixins/iterative_cleanup/jobs/cleaned_uniq.rb,<br /> lib/kiba/extend/mixins/iterative_cleanup/jobs/base_job_cleaned.rb,<br /> lib/kiba/extend/mixins/iterative_cleanup/jobs/returned_compiled.rb,<br /> lib/kiba/extend/mixins/iterative_cleanup/known_worksheet_values.rb</span>
</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>Mixin module for setting up iterative cleanup based on a source table.</p>

<p>“Iterative cleanup” means the client may provide the worksheet more
  than once, or that you may need to produce a fresh worksheet for
  the client after a new database export is provided.</p>

<p>Your project must follow some setup/configuration conventions
  in order to use this mixin:</p>

<ul>
  <li>Each cleanup process must be configured in its own config module.</li>
  <li>A config module is a Ruby module that responds to <code>:config</code>.</li>
</ul>

<p>Refer to
  <a href="https://github.com/lyrasis/kiba-tms/blob/main/lib/kiba/tms/alt_nums_for_obj_type_cleanup.rb">Kiba::Tms::AltNumsForObjTypeCleanup</a>
  as an example config module extending this mixin module in a
  simple way. See
  <a href="https://github.com/lyrasis/kiba-tms/blob/main/lib/kiba/tms/places_cleanup_initial.rb">Kiba::Tms::PlacesCleanupInitial</a>
  for a more complex usage with default overrides and custom
  pre/post transforms.</p>

<h2 id="implementation-details">Implementation details</h2>

<h3 id="define-before-extending-this-module">Define before extending this module</h3>

<p>These can be defined as Dry::Configurable settings or as
  public methods. The section below lists the method/setting
  name the extending module should respond to, each preceded
  by its YARD signature.</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># @return [Symbol] registry entry job key for the job whose output
</span><span class='comment'>#   will be used as the base for generating the cleanup worksheet.
</span><span class='comment'>#   Iterations of cleanup will be layered over this output in the
</span><span class='comment'>#   auto-generated. **NOTE: This job&#39;s output should include a field
</span><span class='comment'>#   which combines/identifies the original values that may be
</span><span class='comment'>#   affected by the cleanup process. The default expectation is that
</span><span class='comment'>#   this field is named :fingerprint, but this can be overridden by
</span><span class='comment'>#   defining a custom `orig_values_identifier` method in the
</span><span class='comment'>#   extending module after extension. This field is used as a
</span><span class='comment'>#   matchpoint for merging cleaned up data back into the migration,
</span><span class='comment'>#   and identifying whether a given value in subsequent worksheet
</span><span class='comment'>#   iterations has been previously included in a worksheet**
</span><span class='comment'># base_job
</span><span class='comment'>#
</span><span class='comment'># @return [Array&lt;Symbol&gt;] fields included in the fingerprint value
</span><span class='comment'># fingerprint_fields
</span></code></pre>

<h3 id="then-extend-this-module">Then, extend this module</h3>

<p><code>extend Kiba::Extend::Mixins::IterativeCleanup</code></p>

<h3 id="methods-that-can-be-optionally-overridden-in-extending-module">Methods that can be optionally overridden in extending module</h3>

<p>Default values for the following methods are defined in this mixin
  module. If you want to override the values, define these methods
  in your config module after extending this module.</p>

<ul>
  <li><span class='object_link'><a href="#cleanup_base_name-instance_method" title="Kiba::Extend::Mixins::IterativeCleanup#cleanup_base_name (method)">#cleanup_base_name</a></span></li>
  <li><span class='object_link'><a href="#orig_values_identifier-instance_method" title="Kiba::Extend::Mixins::IterativeCleanup#orig_values_identifier (method)">#orig_values_identifier</a></span></li>
  <li><span class='object_link'><a href="#job_tags-instance_method" title="Kiba::Extend::Mixins::IterativeCleanup#job_tags (method)">#job_tags</a></span></li>
  <li><span class='object_link'><a href="#worksheet_add_fields-instance_method" title="Kiba::Extend::Mixins::IterativeCleanup#worksheet_add_fields (method)">#worksheet_add_fields</a></span></li>
  <li><span class='object_link'><a href="#worksheet_field_order-instance_method" title="Kiba::Extend::Mixins::IterativeCleanup#worksheet_field_order (method)">#worksheet_field_order</a></span></li>
  <li><span class='object_link'><a href="#collate_fields-instance_method" title="Kiba::Extend::Mixins::IterativeCleanup#collate_fields (method)">#collate_fields</a></span></li>
  <li><span class='object_link'><a href="#collation_delim-instance_method" title="Kiba::Extend::Mixins::IterativeCleanup#collation_delim (method)">#collation_delim</a></span></li>
  <li><span class='object_link'><a href="#clean_fingerprint_flag_ignore_fields-instance_method" title="Kiba::Extend::Mixins::IterativeCleanup#clean_fingerprint_flag_ignore_fields (method)">#clean_fingerprint_flag_ignore_fields</a></span></li>
  <li><span class='object_link'><a href="#final_lookup_on_field-instance_method" title="Kiba::Extend::Mixins::IterativeCleanup#final_lookup_on_field (method)">#final_lookup_on_field</a></span></li>
</ul>

<h2 id="what-extending-this-module-does">What extending this module does</h2>

<h3 id="defines-settings-in-the-extending-config-module">Defines settings in the extending config module</h3>

<p>These are empty settings with constructors that will use the
  values in a client-specific project config file to build the
  data expected for cleanup processing</p>

<ul>
  <li><strong>:provided_worksheets</strong> - Array of filenames of cleanup
worksheets provided to the client. Files should be listed
oldest-to-newest. Assumes files are in the <code>to_client</code>
subdirectory of the migration base directory. <strong>Define actual
values in client config file.</strong></li>
  <li><strong>:returned_files</strong> - Array of filenames of completed worksheets
returned by client. Files should be listed oldest-to-newest.
Assumes files are in the <code>supplied</code> subdirectory of the migration
base directory. <strong>Define actual values in client config file.</strong></li>
</ul>

<h3 id="defines-methods-in-the-extending-config-module">Defines methods in the extending config module</h3>

<p>See method documentation inline below.</p>

<h3 id="prepares-registry-entries-for-iterative-cleanup-jobs">Prepares registry entries for iterative cleanup jobs</h3>

<p>When the project application loads, the method that registers
  the project’s registry entries calls
  <span class='object_link'><a href="../Utils/IterativeCleanupJobRegistrar.html" title="Kiba::Extend::Utils::IterativeCleanupJobRegistrar (class)">Utils::IterativeCleanupJobRegistrar</a></span>. This
  util class calls the <span class='object_link'><a href="#register_cleanup_jobs-instance_method" title="Kiba::Extend::Mixins::IterativeCleanup#register_cleanup_jobs (method)">#register_cleanup_jobs</a></span> method of each
  config module extending this module, adding the cleanup jobs
  to the registry dynamically.</p>

<p>The jobs themselves (i.e. the sources, lookups, transforms)
  are defined in
  <span class='object_link'><a href="IterativeCleanup/Jobs.html" title="Kiba::Extend::Mixins::IterativeCleanup::Jobs (module)">Jobs</a></span>. See that
  module’s documentation for how to set up custom pre/post
  transforms to customize specific cleanup routines.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>4.0.0</p>
</div>
      
    </li>
  
</ul>

</div><h2>Defined Under Namespace</h2>
<p class="children">
  
    
      <strong class="modules">Modules:</strong> <span class='object_link'><a href="IterativeCleanup/Jobs.html" title="Kiba::Extend::Mixins::IterativeCleanup::Jobs (module)">Jobs</a></span>
    
  
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="IterativeCleanup/KnownWorksheetValues.html" title="Kiba::Extend::Mixins::IterativeCleanup::KnownWorksheetValues (class)">KnownWorksheetValues</a></span>
    
  
</p>







  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#datadir-class_method" title="datadir (class method)">.<strong>datadir</strong>(mod)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#extended-class_method" title="extended (class method)">.<strong>extended</strong>(mod)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#all_collate_fields-instance_method" title="#all_collate_fields (instance method)">#<strong>all_collate_fields</strong>  &#x21d2; Array&lt;Symbol&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Ensures that orig_values_identifier is always included in collated   fields.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#base_job_cleaned_job_key-instance_method" title="#base_job_cleaned_job_key (instance method)">#<strong>base_job_cleaned_job_key</strong>  &#x21d2; Symbol </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The registry entry job key for the base job with cleanup merged in.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#clean_fingerprint_flag_ignore_fields-instance_method" title="#clean_fingerprint_flag_ignore_fields (instance method)">#<strong>clean_fingerprint_flag_ignore_fields</strong>  &#x21d2; nil, ... </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Field(s) included in <code>fingerprint_fields</code> setting that   should be ignored when identifying changed/corrected   values in returned worksheets.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#cleaned_uniq_job_key-instance_method" title="#cleaned_uniq_job_key (instance method)">#<strong>cleaned_uniq_job_key</strong>  &#x21d2; Symbol </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The registry entry job key for the job that deduplicates the clean base job data.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#cleanup_base_name-instance_method" title="#cleanup_base_name (instance method)">#<strong>cleanup_base_name</strong>  &#x21d2; String </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Used as the namespace for auto-generated registry entries and the   base for output file names.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#cleanup_done%3F-instance_method" title="#cleanup_done? (instance method)">#<strong>cleanup_done?</strong>  &#x21d2; Boolean </a>
    

    
      (also: #cleanup_done)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#collate_fields-instance_method" title="#collate_fields (instance method)">#<strong>collate_fields</strong>  &#x21d2; Array&lt;:fingerprint&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Fields from base_job_cleaned that will be deleted in   cleaned_uniq, and then merged back into the deduplicated   data of that job from base_job_cleaned.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#collated_orig_values_id_field-instance_method" title="#collated_orig_values_id_field (instance method)">#<strong>collated_orig_values_id_field</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Appends “s” to module’s <code>orig_values_identifier</code>.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#collation_delim-instance_method" title="#collation_delim (instance method)">#<strong>collation_delim</strong>  &#x21d2; String </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Delimiting string used to join collated-on-deduplication   values.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#corrections_job_key-instance_method" title="#corrections_job_key (instance method)">#<strong>corrections_job_key</strong>  &#x21d2; Symbol </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>corrections job.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#final_job_key-instance_method" title="#final_job_key (instance method)">#<strong>final_job_key</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#final_lookup_on_field-instance_method" title="#final_lookup_on_field (instance method)">#<strong>final_lookup_on_field</strong>  &#x21d2; Symbol </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Will be used to set the <code>lookup_on</code> field in job registry   hash for <code>cleanup_base_name__final</code>, for merging   cleaned-up data back into the rest of your migration.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#job_tags-instance_method" title="#job_tags (instance method)">#<strong>job_tags</strong>  &#x21d2; Array&lt;Symbol&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Tags assigned to all jobs generated by IterativeCleanup for   this module.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#orig_values_identifier-instance_method" title="#orig_values_identifier (instance method)">#<strong>orig_values_identifier</strong>  &#x21d2; Symbol </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Field in base job that combines/identifies the original   field values entering the cleanup process.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#register_cleanup_jobs-instance_method" title="#register_cleanup_jobs (instance method)">#<strong>register_cleanup_jobs</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#returned_compiled_job_key-instance_method" title="#returned_compiled_job_key (instance method)">#<strong>returned_compiled_job_key</strong>  &#x21d2; Symbol </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>corrections job.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#returned_file_jobs-instance_method" title="#returned_file_jobs (instance method)">#<strong>returned_file_jobs</strong>  &#x21d2; Array&lt;Symbol&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Supplied registry entry job keys corresponding to returned cleanup files.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#worksheet_add_fields-instance_method" title="#worksheet_add_fields (instance method)">#<strong>worksheet_add_fields</strong>  &#x21d2; Array&lt;Symbol&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Nil/empty fields to be added to worksheet.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#worksheet_field_order-instance_method" title="#worksheet_field_order (instance method)">#<strong>worksheet_field_order</strong>  &#x21d2; Array&lt;Symbol&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Order of fields (in worksheet output).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#worksheet_job_key-instance_method" title="#worksheet_job_key (instance method)">#<strong>worksheet_job_key</strong>  &#x21d2; Symbol </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The registry entry job key for the worksheet prep job.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#worksheet_sent_not_done%3F-instance_method" title="#worksheet_sent_not_done? (instance method)">#<strong>worksheet_sent_not_done?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
    </ul>
  



  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="datadir-class_method">
  
    .<strong>datadir</strong>(mod)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../ProjectSettingUndefinedError.html" title="Kiba::Extend::ProjectSettingUndefinedError (class)">Kiba::Extend::ProjectSettingUndefinedError</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>4.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


382
383
384
385
386
387
388
389
390
391
392
393
394</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/kiba/extend/mixins/iterative_cleanup.rb', line 382</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_datadir'>datadir</span><span class='lparen'>(</span><span class='id identifier rubyid_mod'>mod</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_dir'>dir</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_parents'>parents</span> <span class='op'>=</span> <span class='id identifier rubyid_mod'>mod</span><span class='period'>.</span><span class='id identifier rubyid_module_parents'>module_parents</span>

  <span class='kw'>until</span> <span class='id identifier rubyid_dir'>dir</span> <span class='op'>||</span> <span class='id identifier rubyid_parents'>parents</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_parent'>parent</span> <span class='op'>=</span> <span class='id identifier rubyid_parents'>parents</span><span class='period'>.</span><span class='id identifier rubyid_shift'>shift</span>
    <span class='id identifier rubyid_dir'>dir</span> <span class='op'>=</span> <span class='id identifier rubyid_parent'>parent</span><span class='period'>.</span><span class='id identifier rubyid_datadir'>datadir</span> <span class='kw'>if</span> <span class='id identifier rubyid_parent'>parent</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:datadir</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="../../../Kiba.html" title="Kiba (module)">Kiba</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Extend.html" title="Kiba::Extend (module)">Extend</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../ProjectSettingUndefinedError.html" title="Kiba::Extend::ProjectSettingUndefinedError (class)">ProjectSettingUndefinedError</a></span></span><span class='comma'>,</span> <span class='symbol'>:datadir</span> <span class='kw'>unless</span> <span class='id identifier rubyid_dir'>dir</span>

  <span class='id identifier rubyid_dir'>dir</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="extended-class_method">
  
    .<strong>extended</strong>(mod)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>4.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


113
114
115
116
117
118
119
120</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/kiba/extend/mixins/iterative_cleanup.rb', line 113</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_extended'>extended</span><span class='lparen'>(</span><span class='id identifier rubyid_mod'>mod</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_check_required_settings'>check_required_settings</span><span class='lparen'>(</span><span class='id identifier rubyid_mod'>mod</span><span class='rparen'>)</span>
  <span class='kw'>unless</span> <span class='id identifier rubyid_mod'>mod</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Dry</span><span class='op'>::</span><span class='const'>Configurable</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_mod'>mod</span><span class='period'>.</span><span class='id identifier rubyid_extend'>extend</span><span class='lparen'>(</span><span class='const'>Dry</span><span class='op'>::</span><span class='const'>Configurable</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_define_provided_worksheets_setting'>define_provided_worksheets_setting</span><span class='lparen'>(</span><span class='id identifier rubyid_mod'>mod</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_define_returned_files_setting'>define_returned_files_setting</span><span class='lparen'>(</span><span class='id identifier rubyid_mod'>mod</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="all_collate_fields-instance_method">
  
    #<strong>all_collate_fields</strong>  &#x21d2; <tt>Array&lt;Symbol&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'><p>Override at your peril</p>
</div>
  </div>

<p>Ensures that orig_values_identifier is always included in collated
  fields</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;Symbol&gt;</tt>)</span>
      
      
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>4.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


318
319
320</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/kiba/extend/mixins/iterative_cleanup.rb', line 318</span>

<span class='kw'>def</span> <span class='id identifier rubyid_all_collate_fields'>all_collate_fields</span>
  <span class='lbracket'>[</span><span class='id identifier rubyid_collate_fields'>collate_fields</span><span class='comma'>,</span> <span class='id identifier rubyid_orig_values_identifier'>orig_values_identifier</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_flatten'>flatten</span><span class='period'>.</span><span class='id identifier rubyid_uniq'>uniq</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="base_job_cleaned_job_key-instance_method">
  
    #<strong>base_job_cleaned_job_key</strong>  &#x21d2; <tt>Symbol</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'><p>Do not override</p>
</div>
  </div>

<p>Returns the registry entry job key for the base job
with cleanup merged in.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the registry entry job key for the base job
with cleanup merged in</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>4.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


326
327
328</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/kiba/extend/mixins/iterative_cleanup.rb', line 326</span>

<span class='kw'>def</span> <span class='id identifier rubyid_base_job_cleaned_job_key'>base_job_cleaned_job_key</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cleanup_base_name'>cleanup_base_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>__base_job_cleaned</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="clean_fingerprint_flag_ignore_fields-instance_method">
  
    #<strong>clean_fingerprint_flag_ignore_fields</strong>  &#x21d2; <tt>nil</tt>, ... 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'><p>Optional: override in extending module after extending</p>
</div>
  </div>

<p>Field(s) included in <code>fingerprint_fields</code> setting that
  should be ignored when identifying changed/corrected
  values in returned worksheets. If a Symbol or Array of
  Symbols is given, these are passed as the value of
  <code>ignore_fields</code> when
  <span class='object_link'><a href="../Transforms/Fingerprint/FlagChanged.html" title="Kiba::Extend::Transforms::Fingerprint::FlagChanged (class)">Transforms::Fingerprint::FlagChanged</a></span> is
  called.  DEFAULT VALUE: <code>nil</code></p>

<p>This is included because of two situations that I’ve run into:</p>

<ul>
  <li>I accidentally included a field I shouldn’t have in the
fingerprint and sent a worksheet to the client. For
example, maybe I put <code>:client_cleanup_process_notes</code> in
the <code>worksheet_add_fields</code> setting, told the client these
notes are for their use only and will not be considered
“corrections” or merged into the migration or future
cleanup iterations, but I forgot to subtract this field
from my <code>fingerprint_fields</code> setting.</li>
  <li>I purposefully included a field (e.g. <code>:rowid</code>) present in
my <code>base_job</code> in <code>fingerprint_fields</code> to ensure unique
matchpoints, but didn’t want to include that field in the
client worksheet. If I don’t ignore this field in flagging
changes, <code>:rowid</code> in all returned worksheets is <code>nil</code>,
which does not match the fingerprinted <code>:rowid</code> value, and
thus <strong>every row</strong> is a changed row.</li>
</ul>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>nil</tt>, <tt>Symbol</tt>, <tt>Array&lt;Symbol&gt;</tt>)</span>
      
      
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>4.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


269
270
271</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/kiba/extend/mixins/iterative_cleanup.rb', line 269</span>

<span class='kw'>def</span> <span class='id identifier rubyid_clean_fingerprint_flag_ignore_fields'>clean_fingerprint_flag_ignore_fields</span>
  <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="cleaned_uniq_job_key-instance_method">
  
    #<strong>cleaned_uniq_job_key</strong>  &#x21d2; <tt>Symbol</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'><p>Do not override</p>
</div>
  </div>

<p>Returns the registry entry job key for the job that
deduplicates the clean base job data.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the registry entry job key for the job that
deduplicates the clean base job data</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>4.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


334
335
336</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/kiba/extend/mixins/iterative_cleanup.rb', line 334</span>

<span class='kw'>def</span> <span class='id identifier rubyid_cleaned_uniq_job_key'>cleaned_uniq_job_key</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cleanup_base_name'>cleanup_base_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>__cleaned_uniq</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="cleanup_base_name-instance_method">
  
    #<strong>cleanup_base_name</strong>  &#x21d2; <tt>String</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'><p>Optional: override in extending module after extending</p>
</div>
  </div>

<p>Used as the namespace for auto-generated registry entries and the
  base for output file names. DEFAULT VALUE: the name of
  the extending module, converted to snake case.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>4.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


131
132
133
134
135
136</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/kiba/extend/mixins/iterative_cleanup.rb', line 131</span>

<span class='kw'>def</span> <span class='id identifier rubyid_cleanup_base_name'>cleanup_base_name</span>
  <span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>::</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span>
    <span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>([A-Z])</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>_\1</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='period'>.</span><span class='id identifier rubyid_delete_prefix'>delete_prefix</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="cleanup_done?-instance_method">
  
    #<strong>cleanup_done?</strong>  &#x21d2; <tt>Boolean</tt> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='cleanup_done-instance_method'>cleanup_done</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'><p>Do not override</p>
</div>
  </div>




  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>4.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


300
301
302</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/kiba/extend/mixins/iterative_cleanup.rb', line 300</span>

<span class='kw'>def</span> <span class='id identifier rubyid_cleanup_done?'>cleanup_done?</span>
  <span class='kw'>true</span> <span class='kw'>unless</span> <span class='id identifier rubyid_returned_files'>returned_files</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="collate_fields-instance_method">
  
    #<strong>collate_fields</strong>  &#x21d2; <tt>Array&lt;:fingerprint&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'><p>Optional: override in extending module after extending</p>
</div>
  </div>

<p>Fields from base_job_cleaned that will be deleted in
  cleaned_uniq, and then merged back into the deduplicated
  data of that job from base_job_cleaned. I.e., fields whose
  values will be collated into multivalued fields on the
  deduplicated values. DEFAULT VALUE: <code>[]</code></p>

<p>Note that <code>:fingerprint</code> (or your overridden orig_values_identifier)
  is added to these values by the <span class='object_link'><a href="#all_collate_fields-instance_method" title="Kiba::Extend::Mixins::IterativeCleanup#all_collate_fields (method)">#all_collate_fields</a></span> method. That
  field should always be collated, or you will not be able to match
  final cleaned values back to original migration data.</p>

<p>An example of when you might want to add additional collate
  fields: For authority term cleanup, especially if we are
  breaking up subject headings into individual subdivisions,
  I like to provide the full subject heading from which the
  term was derived, for context. For example, <code>:subdivision</code>
  = “History”, <code>:fullheading</code> = “Ghana – History”. If you
  also have row with <code>:subdivision</code> = “Histories”,
  <code>:fullheading</code> = “Ghana – Histories”, and the client
  corrects “Histories” to “History” in that row, if you
  include <code>:fullheading</code> in <code>collate_fields</code>, a subsequently
  generated worksheet row with <code>:subdivision</code> = “History”
  will have <code>:fullheading</code> = “Ghana – History\\Ghana –
  Histories”.</p>

<p>It can also be useful for clients with large cleanup
  projects to provide the number of occurrences for each
  value in the project. Retain this information through
  multiple cleanup iterations by collating the occurrences
  field and adding an inline transform to split and sum the
  values in a custom <code>cleaned_uniq_post_xforms</code> method. See
  <a href="https://github.com/lyrasis/kiba-tms/blob/main/lib/kiba/tms/places_cleanup_initial.rb">Tms::PlacesCleanupInitial</a>
  for an example</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;:fingerprint&gt;</tt>)</span>
      
      
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>4.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


224
225
226</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/kiba/extend/mixins/iterative_cleanup.rb', line 224</span>

<span class='kw'>def</span> <span class='id identifier rubyid_collate_fields'>collate_fields</span>
  <span class='lbracket'>[</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="collated_orig_values_id_field-instance_method">
  
    #<strong>collated_orig_values_id_field</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Appends “s” to module’s <code>orig_values_identifier</code>. Used to
  manage joining, collating, and splitting/exploding on this
  value, while clarifying that any collated field in output
  is collated (not expected to be a single value.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>4.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


369
370
371</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/kiba/extend/mixins/iterative_cleanup.rb', line 369</span>

<span class='kw'>def</span> <span class='id identifier rubyid_collated_orig_values_id_field'>collated_orig_values_id_field</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_orig_values_identifier'>orig_values_identifier</span><span class='embexpr_end'>}</span><span class='tstring_content'>s</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="collation_delim-instance_method">
  
    #<strong>collation_delim</strong>  &#x21d2; <tt>String</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'><p>Optional: override in extending module after extending</p>
</div>
  </div>

<p>Delimiting string used to join collated-on-deduplication
  values. Should be distinct from normal application
  delimiters since the field values being joined/split may
  contain the normal application delimiters. DEFAULT VALUE: <code>"////"</code></p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>4.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


236
237
238</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/kiba/extend/mixins/iterative_cleanup.rb', line 236</span>

<span class='kw'>def</span> <span class='id identifier rubyid_collation_delim'>collation_delim</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>////</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="corrections_job_key-instance_method">
  
    #<strong>corrections_job_key</strong>  &#x21d2; <tt>Symbol</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'><p>Do not override</p>
</div>
  </div>

<p>corrections job</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the registry entry job key for the compiled</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>4.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


357
358
359</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/kiba/extend/mixins/iterative_cleanup.rb', line 357</span>

<span class='kw'>def</span> <span class='id identifier rubyid_corrections_job_key'>corrections_job_key</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cleanup_base_name'>cleanup_base_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>__corrections</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="final_job_key-instance_method">
  
    #<strong>final_job_key</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>4.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


361
362
363</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/kiba/extend/mixins/iterative_cleanup.rb', line 361</span>

<span class='kw'>def</span> <span class='id identifier rubyid_final_job_key'>final_job_key</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cleanup_base_name'>cleanup_base_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>__final</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="final_lookup_on_field-instance_method">
  
    #<strong>final_lookup_on_field</strong>  &#x21d2; <tt>Symbol</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'><p>Optional: override in extending module after extending</p>
</div>
  </div>

<p>Will be used to set the <code>lookup_on</code> field in job registry
  hash for <code>cleanup_base_name__final</code>, for merging
  cleaned-up data back into the rest of your migration.
  DEFAULT VALUE: value of orig_values_identifier</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Symbol</tt>)</span>
      
      
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>4.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


281
282
283</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/kiba/extend/mixins/iterative_cleanup.rb', line 281</span>

<span class='kw'>def</span> <span class='id identifier rubyid_final_lookup_on_field'>final_lookup_on_field</span>
  <span class='id identifier rubyid_orig_values_identifier'>orig_values_identifier</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="job_tags-instance_method">
  
    #<strong>job_tags</strong>  &#x21d2; <tt>Array&lt;Symbol&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'><p>Optional: override in extending module after extending</p>
</div>
  </div>

<p>Tags assigned to all jobs generated by IterativeCleanup for
  this module. Tags allow retrieval and running of jobs via
  <code>thor jobs:tagged</code>, <code>thor jobs:tagged_or</code>, and <code>thor
  jobs:tagged_and</code> commands. DEFAULT VALUE: <code>[]</code> (empty
  array)</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;Symbol&gt;</tt>)</span>
      
      
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>4.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


161
162
163</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/kiba/extend/mixins/iterative_cleanup.rb', line 161</span>

<span class='kw'>def</span> <span class='id identifier rubyid_job_tags'>job_tags</span>
  <span class='lbracket'>[</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="orig_values_identifier-instance_method">
  
    #<strong>orig_values_identifier</strong>  &#x21d2; <tt>Symbol</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'><p>Optional: override in extending module after extending</p>
</div>
  </div>

<p>Field in base job that combines/identifies the original
  field values entering the cleanup process. This field is
  used as a matchpoint for merging cleaned up data back into
  the migration, and identifying whether a given value in
  subsequent worksheet iterations has been previously
  included in a worksheet. DEFAULT VALUE: <code>:fingerprint</code></p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Symbol</tt>)</span>
      
      
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>4.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


148
149
150</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/kiba/extend/mixins/iterative_cleanup.rb', line 148</span>

<span class='kw'>def</span> <span class='id identifier rubyid_orig_values_identifier'>orig_values_identifier</span>
  <span class='symbol'>:fingerprint</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="register_cleanup_jobs-instance_method">
  
    #<strong>register_cleanup_jobs</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>4.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


438
439
440
441</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/kiba/extend/mixins/iterative_cleanup.rb', line 438</span>

<span class='kw'>def</span> <span class='id identifier rubyid_register_cleanup_jobs'>register_cleanup_jobs</span>
  <span class='id identifier rubyid_ns'>ns</span> <span class='op'>=</span> <span class='id identifier rubyid_build_namespace'>build_namespace</span>
  <span class='const'><span class='object_link'><a href="../../../Kiba.html" title="Kiba (module)">Kiba</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Extend.html" title="Kiba::Extend (module)">Extend</a></span></span><span class='period'>.</span><span class='id identifier rubyid_registry'><span class='object_link'><a href="../../Extend.html#registry-class_method" title="Kiba::Extend.registry (method)">registry</a></span></span><span class='period'>.</span><span class='id identifier rubyid_import'>import</span><span class='lparen'>(</span><span class='id identifier rubyid_ns'>ns</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="returned_compiled_job_key-instance_method">
  
    #<strong>returned_compiled_job_key</strong>  &#x21d2; <tt>Symbol</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'><p>Do not override</p>
</div>
  </div>

<p>corrections job</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the registry entry job key for the compiled</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>4.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


349
350
351</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/kiba/extend/mixins/iterative_cleanup.rb', line 349</span>

<span class='kw'>def</span> <span class='id identifier rubyid_returned_compiled_job_key'>returned_compiled_job_key</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cleanup_base_name'>cleanup_base_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>__returned_compiled</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="returned_file_jobs-instance_method">
  
    #<strong>returned_file_jobs</strong>  &#x21d2; <tt>Array&lt;Symbol&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'><p>Do not override</p>
</div>
  </div>

<p>Returns supplied registry entry job keys
corresponding to returned cleanup files.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;Symbol&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>supplied registry entry job keys
corresponding to returned cleanup files</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>4.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


291
292
293
294
295</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/kiba/extend/mixins/iterative_cleanup.rb', line 291</span>

<span class='kw'>def</span> <span class='id identifier rubyid_returned_file_jobs'>returned_file_jobs</span>
  <span class='id identifier rubyid_returned_files'>returned_files</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='period'>.</span><span class='id identifier rubyid_with_index'>with_index</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_filename'>filename</span><span class='comma'>,</span> <span class='id identifier rubyid_idx'>idx</span><span class='op'>|</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cleanup_base_name'>cleanup_base_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>__file_returned_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_idx'>idx</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="worksheet_add_fields-instance_method">
  
    #<strong>worksheet_add_fields</strong>  &#x21d2; <tt>Array&lt;Symbol&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'><p>Optional: override in extending module after extending</p>
</div>
  </div>

<p>Nil/empty fields to be added to worksheet. Note: values from these
  fields are retained from returned cleanup worksheets if these fields
  are included in <code>fingerprint_fields</code>. DEFAULT VALUE: <code>[]</code></p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;Symbol&gt;</tt>)</span>
      
      
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>4.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


172
173
174</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/kiba/extend/mixins/iterative_cleanup.rb', line 172</span>

<span class='kw'>def</span> <span class='id identifier rubyid_worksheet_add_fields'>worksheet_add_fields</span>
  <span class='lbracket'>[</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="worksheet_field_order-instance_method">
  
    #<strong>worksheet_field_order</strong>  &#x21d2; <tt>Array&lt;Symbol&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'><p>Optional: override in extending module after extending</p>
</div>
  </div>

<p>Order of fields (in worksheet output). Will be used to set
  destination special options/initial headers on the
  worksheet job. DEFAULT VALUE: <code>[]</code></p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;Symbol&gt;</tt>)</span>
      
      
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>4.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


183
184
185</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/kiba/extend/mixins/iterative_cleanup.rb', line 183</span>

<span class='kw'>def</span> <span class='id identifier rubyid_worksheet_field_order'>worksheet_field_order</span>
  <span class='lbracket'>[</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="worksheet_job_key-instance_method">
  
    #<strong>worksheet_job_key</strong>  &#x21d2; <tt>Symbol</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'><p>Do not override</p>
</div>
  </div>

<p>Returns the registry entry job key for the worksheet prep job.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the registry entry job key for the worksheet prep job</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>4.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


341
342
343</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/kiba/extend/mixins/iterative_cleanup.rb', line 341</span>

<span class='kw'>def</span> <span class='id identifier rubyid_worksheet_job_key'>worksheet_job_key</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cleanup_base_name'>cleanup_base_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>__worksheet</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="worksheet_sent_not_done?-instance_method">
  
    #<strong>worksheet_sent_not_done?</strong>  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'><p>Do not override</p>
</div>
  </div>




  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>4.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


308
309
310</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/kiba/extend/mixins/iterative_cleanup.rb', line 308</span>

<span class='kw'>def</span> <span class='id identifier rubyid_worksheet_sent_not_done?'>worksheet_sent_not_done?</span>
  <span class='kw'>true</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_cleanup_done?'>cleanup_done?</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_provided_worksheets'>provided_worksheets</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Mon Aug 12 20:21:36 2024 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.36 (ruby-3.1.6).
</div>

    </div>
  </body>
</html>