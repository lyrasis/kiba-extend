:toc:
:toc-placement!:
:toclevels: 4

ifdef::env-github[]
:tip-caption: :bulb:
:note-caption: :information_source:
:important-caption: :heavy_exclamation_mark:
:caution-caption: :fire:
:warning-caption: :warning:
endif::[]

= Changelog
All notable changes to this project from 2021-10-04 onward will be documented in this file.

Changes made prior to 2021-03-09 may ever be added retrospectively, but consult https://github.com/lyrasis/kiba-extend/releases/[Github Releases for the project] in the indefinite meantime.

The format is based on https://keepachangelog.com/en/1.0.0/[Keep a Changelog],
and this project adheres to https://semver.org/spec/v2.0.0.html[Semantic Versioning].

toc::[]

== Planned
=== Release after 2.9.0
* Remove `Clean::DelimiterOnlyFields`
* Remove `CombineValues::AcrossFieldGroup`
* Remove `Reshape::CollapseMultipleFieldsToOneTypedFieldPair`
* Remove `FilterRows::FieldValueGreaterThan`
* Remove `Helpers.delim_only?`
* Remove `Helpers.field_values`

== Unreleased
These changes are merged into the `main` branch but have not yet been tagged as a new version/release.

==== Breaking

==== Added

==== Changed

==== Deleted

==== To be deprecated/Will break in a future version

== Releases
=== 2.9.0 - 2022-07-19
https://github.com/lyrasis/kiba-extend/compare/v2.8.0\...v2.9.0[Compare code changes]

==== Breaking
* Removes Hash `conditions` parameter and `sep` parameter from `Merge::ConstantValueConditional` transform, replacing with lambda Proc `condition` parameter. In https://github.com/lyrasis/kiba-extend/pull/88[PR#88]
* **Only relevant if you have called global `Kiba::Extend::DELIM` or `Kiba::Extend::CSVOPT` from outside Kiba::Extend for some reason.** These global constants were finally removed from the final few places they were being used within kiba-extend, and they have been removed from the application setup.

==== Added
* New service object classes in `Transforms::Helpers` in https://github.com/lyrasis/kiba-extend/pull/92[PR#92]:
** `DelimOnlyChecker`
** `FieldValueGetter`
** `RowFieldEvennessChecker`

* New transforms:
** `Clean::EvenFieldValues` (in https://github.com/lyrasis/kiba-extend/pull/92[PR#92])
** `Collapse::FieldsToRepeatableFieldGroup` (in https://github.com/lyrasis/kiba-extend/pull/92[PR#92])
** `Collapse::FieldsToTypedFieldPair` (in https://github.com/lyrasis/kiba-extend/pull/92[PR#92])
** `Collapse::FieldsWithCustomFieldmap` (in https://github.com/lyrasis/kiba-extend/pull/92[PR#92])
** `Deduplicate::FlagAll` (in https://github.com/lyrasis/kiba-extend/pull/92[PR#92])
** `Delete::DelimiterOnlyFieldValues` (in https://github.com/lyrasis/kiba-extend/pull/92[PR#92])
** `Delete::EmptyFieldGroups` (in https://github.com/lyrasis/kiba-extend/pull/92[PR#92])
** `FilterRows::AllFieldsPopulated` (in https://github.com/lyrasis/kiba-extend/pull/85[PR#85])
** `FilterRows::AnyFieldsPopulated` (in https://github.com/lyrasis/kiba-extend/pull/85[PR#85])
** `FilterRows::WithLambda` (in https://github.com/lyrasis/kiba-extend/pull/85[PR#85])
** `Merge::ConstantValues` (in https://github.com/lyrasis/kiba-extend/pull/84[PR#84])
** `Replace::EmptyFieldValues` (in https://github.com/lyrasis/kiba-extend/pull/92[PR#92])
** `Reshape::FieldsToFieldGroupWithConstant` (in https://github.com/lyrasis/kiba-extend/pull/92[PR#92])
** `Warn::UnevenFields` (in https://github.com/lyrasis/kiba-extend/pull/92[PR#92])

* `stripextra` csv converter to do aggressive stripping of csv field values, _without_ converting 'NULL' strings to ``nilValue``s. In https://github.com/lyrasis/kiba-extend/pull/91[PR#91]
* `ignore_case` parameter to `FilterRows::FieldMatchRegexp` transform. Defaults to `false` for backward compatibility. In https://github.com/lyrasis/kiba-extend/pull/85[PR#85]

==== Changed
* BUGFIX: `Utils::Lookup::RowSorter` no longer fails if all rows given to sort have blank values. In https://github.com/lyrasis/kiba-extend/pull/92[PR#92]
* BUGFIX: `Clean::EmptyFieldGroups` was broken if `sep` = `|` and `use_nullvalue` = `true`. In https://github.com/lyrasis/kiba-extend/pull/92[PR#92]
* BUGFIX: No longer runs the same dependency job multiple times. In https://github.com/lyrasis/kiba-extend/pull/90[PR#90]
* In `Merge::ConstantValueConditional` transform, lambda Proc is passed in as `condition`, rather than `conditions`. In https://github.com/lyrasis/kiba-extend/pull/88[PR#88]
* If source data is an ISO 3166 code, `Cspace::AddressCountry` passes that value through to target. Adds some more lookup keys to support client data set. In https://github.com/lyrasis/kiba-extend/pull/87[PR#87]
* `Merge::ConstantValue` warns (once per transform) if `target` is an existing field containing any data. In https://github.com/lyrasis/kiba-extend/pull/84[PR#84]
* BUGFIX: `RowSorter` checks for presence of `sortfield` and raises error if it doesn't exist, rather than trying to proceed and blowing up. In https://github.com/lyrasis/kiba-extend/pull/83[PR#83]

==== Deleted
* Removes Hash `conditions` parameter and `sep` parameter from `Merge::ConstantValueConditional` transform, replacing with lambda Proc `condition` parameter. In https://github.com/lyrasis/kiba-extend/pull/88[PR#88]

==== To be deprecated/Will break in a future version
* Deprecates `Helpers.delim_only?`, replacing with `Helpers::DelimOnlyChecker` service class. In https://github.com/lyrasis/kiba-extend/pull/92[PR#92]
* Deprecates `Clean::DelimiterOnlyFields`, replacing with `Delete::DelimiterOnlyFieldValues` . In https://github.com/lyrasis/kiba-extend/pull/92[PR#92]
* Deprecates `Reshape::CollapseMultipleFieldsToOneTypedFieldPair`, replacing with `Collapse::FieldsToTypedFieldPair` . In https://github.com/lyrasis/kiba-extend/pull/92[PR#92]
* Deprecates `CombineValues::AcrossFieldGroup`, replacing with `Collapse::FieldsWithCustomFieldmap` . In https://github.com/lyrasis/kiba-extend/pull/92[PR#92]
* Deprecates `FilterRows::FieldValueGreaterThan`. In https://github.com/lyrasis/kiba-extend/pull/86[PR#86]

=== 2.8.0 - 2022-05-13
https://github.com/lyrasis/kiba-extend/compare/v2.7.2\...v2.8.0[Compare code changes]

==== Breaking
* `Count::MatchingRowsInLookup` previously returned Integers. Now it defaults to returning Strings, since many of the transforms assume all field values will be strings. If you were calling `Count::MatchingRowsInLookup` in a job and working with the integer result as an integer within that job, this will be a breaking change. In https://github.com/lyrasis/kiba-extend/pull/69[PR#69]

==== Added
* `Lookup::RowSorter` class and the ability to pass it in as an argument to `Merge::MultiRowLookup` transform to explicitly control the order in which matching rows are merged. In https://github.com/lyrasis/kiba-extend/pull/82[PR#82]
* Ability to pass in a Lambda as a `conditions` argument on transforms. This provides a more straightforward and infinitely flexible alternative to the horrible, poorly documented Hash expression of conditions. In https://github.com/lyrasis/kiba-extend/pull/82[PR#82]
* Add `Rename::Fields` transform. In https://github.com/lyrasis/kiba-extend/pull/75[PR#75]
* Add `Name::SplitInverted` and `Name::ConvertInvertedToDirectForm` transforms. In https://github.com/lyrasis/kiba-extend/pull/74[PR#74]
* Add `Allable` mixin module for transforms that accept `fields: :all`. In https://github.com/lyrasis/kiba-extend/pull/73[PR#73]
* Add `Cspace::AddressCountry` transform. In https://github.com/lyrasis/kiba-extend/pull/72[PR#72]. Made more configurable in https://github.com/lyrasis/kiba-extend/pull/75[PR#75]
* Add `null_placeholder` parameter to `Merge::MultiRowLookup`, which will replace any blank values in merged field values with the given string. Useful for building repeating field groups in CollectionSpace migrations. In https://github.com/lyrasis/kiba-extend/pull/70[PR#70]

==== Changed
* Raise `LookupTypeError` when `Merge::MultiRowLookup` is called with `lookup` parameter that is not a Hash. In https://github.com/lyrasis/kiba-extend/pull/81[PR#81]
* Improved exception handling when `MissingDependencyError` is raised. In https://github.com/lyrasis/kiba-extend/pull/80[PR#80]
* Improved error message for `Copy::Field`. In https://github.com/lyrasis/kiba-extend/pull/78[PR#78]
* Add improved error handling in jobs when a transform raises a `Kiba::Extend::Error`. In https://github.com/lyrasis/kiba-extend/pull/77[PR#77].
* Improved exception handling when `KeyNotRegisteredError` is raised, as per https://github.com/lyrasis/kiba-extend/issues/64[GH#64]. In https://github.com/lyrasis/kiba-extend/pull/79[PR#79]
* More informative error message if you pass in a non-existent `using` hash when calling `Deduplicate::Flag` transform. In https://github.com/lyrasis/kiba-extend/pull/76[PR#76]
* `Rename::Field` now warns if the `to` field already exists and will be overwritten. In https://github.com/lyrasis/kiba-extend/pull/75[PR#75]
* Use zeitwerk for autoloading. In https://github.com/lyrasis/kiba-extend/pull/75[PR#75]. Bugfix for use in projects implemented in https://github.com/lyrasis/kiba-extend/pull/76[PR#76] via eager autoload.
* Make `Delete::EmptyFieldValues` `Allable`. In https://github.com/lyrasis/kiba-extend/pull/73[PR#73]
* If given an "existing" field that does not exist, `Rename::Field` transform will warn about it, but not throw an exception. This supports building reusable jobs where the data may be slightly different from use to use. In https://github.com/lyrasis/kiba-extend/pull/71[PR#71]
* BUGFIX: `Clean::RegexpFindReplaceFieldVals` now skips non-string field values instead of trying to call `:gsub` on them and failing with `NoMethodError`. In https://github.com/lyrasis/kiba-extend/pull/68[PR#68]

=== 2.7.2 - 2022-04-05
https://github.com/lyrasis/kiba-extend/compare/v2.7.1\...v2.7.2[Compare code changes]

==== Added
* When setting up a file registry hash, `creator` may be a `Hash` if you need to pass keyword arguments to your job. See https://lyrasis.github.io/kiba-extend/file.file_registry_entry.html#creator[File registry entry reference] for more info and examples. In https://github.com/lyrasis/kiba-extend/pull/67[PR#67]
* When setting up a file registry hash, `creator` may be a `Module` if the relevant job is a private instance method named with the configured `default_job_method_name` (The default is `:job`). See https://lyrasis.github.io/kiba-extend/file.file_registry_entry.html#creator[File registry entry reference] for more info and examples. In https://github.com/lyrasis/kiba-extend/pull/67[PR#67]
* `default_job_method_name` config setting. In https://github.com/lyrasis/kiba-extend/pull/67[PR#67]
* `Fingerprint::Add` and `Fingerprint::Decode` transforms. In https://github.com/lyrasis/kiba-extend/pull/65[PR#65]
* `override_app_delim_check` param to `Fingerprint::Add` for backward compatibility with a project I want to be able to use this transform. Defaults to `false`. https://github.com/lyrasis/kiba-extend/pull/66[PR#66]

==== Changed
* Moves `Merge::CompareFieldsFlag` to `Compare::FieldValues`. Aliases the old transform to the new one for backward compatibility, but raises deprecation warning. In https://github.com/lyrasis/kiba-extend/pull/62[PR#62]
* `Fingerprint::Decode` forces field values to UTF-8, preventing CSV write errors. In https://github.com/lyrasis/kiba-extend/pull/66[PR#66]

=== 2.7.1 - 2022-03-10
https://github.com/lyrasis/kiba-extend/compare/v2.6.1\...v2.7.1[Compare code changes]

==== Added
* `Kiba::Extend::Utils::MultiSourceNormalizer` and `Kiba::Extend::Jobs::MultiSourcePrepJob` to handle normalization of fields across multiple sources to be used in a multiple-source job with a `Kiba::Extend::Destinations::CSV` destination (in https://github.com/lyrasis/kiba-extend/pull/60[PR#60])
* `explicit_no` argument to `Kiba::Extend::Transforms::Deduplicate::Flag`. Defaults to `true` for backward compatibility (in https://github.com/lyrasis/kiba-extend/pull/60[PR#60])
* `amazing_print` dependency  (in https://github.com/lyrasis/kiba-extend/pull/61[PR#61])

=== 2.6.1 - 2022-03-09
https://github.com/lyrasis/kiba-extend/compare/v2.6.0\...v2.6.1[Compare code changes]

==== Breaking
* `mvdelim` keyword argument removed from `Prepend::ToFieldValue`, and replaced by `multival` and `delim`

==== Added
* Binstub for running rspec without `bundler exec` (given that you add `kiba-extend/bin` to your PATH) (in https://github.com/lyrasis/kiba-extend/pull/59[PR#59])
* `lookup_on` to registry entry summary (in https://github.com/lyrasis/kiba-extend/pull/59[PR#59])

==== Changed
* `Explode::RowsFromMultivalField` defaults to using `Kiba::Extend.delim` if no `delim` keyword argument passed in (in https://github.com/lyrasis/kiba-extend/pull/58[PR#58])
* Some documentation formatting fixed (https://github.com/lyrasis/kiba-extend/issues/53[Issue #53]) (in https://github.com/lyrasis/kiba-extend/pull/58[PR#58])
* Requires higher versions of Ruby, Bundler, and Rspec (in https://github.com/lyrasis/kiba-extend/pull/59[PR#59])

=== 2.6.0 - 2022-02-24

https://github.com/lyrasis/kiba-extend/compare/v2.5.3\...v2.6.0[Compare code changes]

==== Breaking
* Changes to keyword argument names for `Delete::FieldValueIfEqualsOtherField` (in https://github.com/lyrasis/kiba-extend/pull/57[PR#57])
** `sep` becomes `delim`
** `case_sensitive` becomes `casesensitive`

==== Added
*  `multival` parameter added to `Cspace::NormalizeForID` transform (in https://github.com/lyrasis/kiba-extend/pull/49[PR#49])
*  new https://lyrasis.github.io/kiba-extend/Kiba/Extend/Transforms/Count/FieldValues.html[`Count::FieldValues`] transform (in https://github.com/lyrasis/kiba-extend/pull/50[PR#50])
*  new https://lyrasis.github.io/kiba-extend/Kiba/Extend/Transforms/Append/ConvertedValueAndUnit.html[`Append::ConvertedValueAndUnit`] transform (in https://github.com/lyrasis/kiba-extend/pull/51[PR#51])
*  preparation of the file registry:
** warns of any supplied files that do not exist (in https://github.com/lyrasis/kiba-extend/pull/54[PR#54])
** creates any reference directories that do not exist (in https://github.com/lyrasis/kiba-extend/pull/54[PR#54])
* test Clean::RegexpFindReplaceFieldVals to replace `\n` (in https://github.com/lyrasis/kiba-extend/pull/55[PR#55])
* `Helpers.empty?` method, which returns true/false for a given string value (without treating delimiter values as special)  (in https://github.com/lyrasis/kiba-extend/pull/57[PR#57])
* `fields` keyword argument to `Delete::FieldsExcept`, which should be used going forward instead of `keepfields` (in https://github.com/lyrasis/kiba-extend/pull/57[PR#57])
* `nullvalue` setting to `Kiba::Extend.config`. Default value is '%NULLVALUE%' (in https://github.com/lyrasis/kiba-extend/pull/57[PR#57])
* `usenull` keyword argument to `Delete::EmptyFieldValues` (in https://github.com/lyrasis/kiba-extend/pull/57[PR#57])
* `delim` keyword argument to `Delete::EmptyFieldValues`, which should be used going forward instead of `sep` (in https://github.com/lyrasis/kiba-extend/pull/57[PR#57])
* documentation for `Delete` transforms (in https://github.com/lyrasis/kiba-extend/pull/57[PR#57])
* `Delete::BlankFields` transform (in https://github.com/lyrasis/kiba-extend/pull/57[PR#57])

==== Changed
* move/alias `Merge::CountOfMatchingRows` to `Count::MatchingRowsInLookup`(in https://github.com/lyrasis/kiba-extend/pull/50[PR#50])
* `Delete::FieldsExcept` can accept a single symbol as value for `fields` keyword argument (in https://github.com/lyrasis/kiba-extend/pull/57[PR#57])
* `Delete::EmptyFieldValues` will default to `Kiba::Extend.delim` as delimiter if none given explicitly (in https://github.com/lyrasis/kiba-extend/pull/57[PR#57])
* keyword argument names for `Delete::FieldValueIfEqualsOtherField` (in https://github.com/lyrasis/kiba-extend/pull/57[PR#57])
** `sep` becomes `delim`
** `case_sensitive` becomes `casesensitive`

==== Deleted
- Removed JARD as development dependency (in https://github.com/lyrasis/kiba-extend/pull/52[PR#52])
- Removed `-t` alias from `jobs:tagged_and` and `jobs:tagged_or` tasks, as they conflicted with the `-t/--tell` option (in https://github.com/lyrasis/kiba-extend/pull/56[PR#56])

==== To be deprecated/Will break in a future version
These will now give warnings if used.

- `Delete::FieldsExcept` `keepfields` keyword parameter. Change to `fields`  (in https://github.com/lyrasis/kiba-extend/pull/57[PR#57])
- `Delete::EmptyFieldValues` `sep` keyword parameter. Change to `delim`  (in https://github.com/lyrasis/kiba-extend/pull/57[PR#57])

