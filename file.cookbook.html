<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  File: cookbook
  
    &mdash; Kiba-Extend Documentation
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" />

  <link rel="stylesheet" href="css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "cookbook";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="file_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: cookbook</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><div id='filecontents'><h1 id="kiba-extend-cookbook">kiba-extend cookbook</h1>

<p>A place to share patterns for handling common workflows.</p>

<h2 id="produce-cleanup-worksheet-for-client">Produce cleanup worksheet for client</h2>

<p>Client has &gt;10,000 source records. Their <code>description</code> field is free-text, but they have mostly entered data by cutting and pasting from the data entry guide for their previous system. However, some irregularities have crept in that they would like to clean up. Some of these irregularities may have been copied to many records by cloning records in the source system.</p>

<p>We want to provide an efficient way for the client to review and provide corrections for any irregular values.</p>

<p>We assume there will be other fields they may also want to clean up in a similar way, so we want to set up a pattern for this.</p>

<p>Create a namespace in the registry for cleanup worksheets. Register the output of the job that will create the <code>description</code> cleanup worksheet:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># in clientproject/lib/client/registry_data.rb
</span>
<span class='const'>Client</span><span class='period'>.</span><span class='id identifier rubyid_registry'>registry</span><span class='period'>.</span><span class='id identifier rubyid_namespace'>namespace</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>cleanup_wrkshts</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_register'>register</span> <span class='symbol'>:description</span><span class='comma'>,</span> <span class='lbrace'>{</span>
    <span class='label'>path:</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='const'>Client</span><span class='period'>.</span><span class='id identifier rubyid_datadir'>datadir</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>to_client</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>description_cleanup.csv</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='comma'>,</span>
    <span class='label'>creator:</span> <span class='const'>Client</span><span class='op'>::</span><span class='const'>Jobs</span><span class='op'>::</span><span class='const'>CleanupWrkshts</span><span class='op'>::</span><span class='const'>Description</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span>
</code></pre>

<p>Here is the job to create the worksheet. The source data is in CSV format, with &gt;10,000 rows and &gt;30 columns:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># clientproject/lib/client/jobs/cleanup_wrkshts/description.rb
</span>
<span class='kw'>module</span> <span class='const'>Client</span>
  <span class='kw'>module</span> <span class='const'>Jobs</span>
    <span class='kw'>module</span> <span class='const'>CleanupWrkshts</span>
      <span class='kw'>module</span> <span class='const'>Description</span>
        <span class='id identifier rubyid_module_function'>module_function</span>

        <span class='kw'>def</span> <span class='id identifier rubyid_job'>job</span>
          <span class='const'><span class='object_link'><a href="Kiba.html" title="Kiba (module)">Kiba</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Kiba/Extend.html" title="Kiba::Extend (module)">Extend</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Kiba/Extend/Jobs.html" title="Kiba::Extend::Jobs (module)">Jobs</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Kiba/Extend/Jobs/Job.html" title="Kiba::Extend::Jobs::Job (class)">Job</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Kiba/Extend/Jobs/BaseJob.html#initialize-instance_method" title="Kiba::Extend::Jobs::BaseJob#initialize (method)">new</a></span></span><span class='lparen'>(</span>
            <span class='label'>files:</span> <span class='lbrace'>{</span>
              <span class='label'>source:</span> <span class='symbol'>:base__data</span><span class='comma'>,</span>
              <span class='label'>destination:</span> <span class='symbol'>:cleanup_wrkshts__description</span>
            <span class='rbrace'>}</span><span class='comma'>,</span>
            <span class='label'>transformer:</span> <span class='id identifier rubyid_xforms'>xforms</span>
          <span class='rparen'>)</span>
        <span class='kw'>end</span>

        <span class='kw'>def</span> <span class='id identifier rubyid_xforms'>xforms</span>
          <span class='const'><span class='object_link'><a href="Kiba.html" title="Kiba (module)">Kiba</a></span></span><span class='period'>.</span><span class='id identifier rubyid_job_segment'><span class='object_link'><a href="Kiba/Extend/Jobs/JobSegmenter.html#job_segment-instance_method" title="Kiba::Extend::Jobs::JobSegmenter#job_segment (method)">job_segment</a></span></span> <span class='kw'>do</span>
            <span class='comment'># We only care about the description values in the cleanup worksheet
</span>            <span class='id identifier rubyid_transform'>transform</span> <span class='const'>Delete</span><span class='op'>::</span><span class='const'>FieldsExcept</span><span class='comma'>,</span>
              <span class='label'>fields:</span> <span class='symbol'>:description</span>
            <span class='id identifier rubyid_transform'>transform</span> <span class='const'>FilterRows</span><span class='op'>::</span><span class='const'>FieldPopulated</span><span class='comma'>,</span>
              <span class='label'>action:</span> <span class='symbol'>:keep</span><span class='comma'>,</span>
              <span class='label'>field:</span> <span class='symbol'>:description</span>
            <span class='id identifier rubyid_transform'>transform</span> <span class='const'>Deduplicate</span><span class='op'>::</span><span class='const'>Table</span><span class='comma'>,</span>
              <span class='label'>field:</span> <span class='symbol'>:description</span><span class='comma'>,</span>
              <span class='label'>delete_field:</span> <span class='kw'>false</span>
            <span class='comment'># Create the field they&#39;ll enter any corrections into
</span>            <span class='id identifier rubyid_transform'>transform</span> <span class='const'>Append</span><span class='op'>::</span><span class='const'>NilFields</span><span class='comma'>,</span>
              <span class='label'>fields:</span> <span class='qsymbols_beg'>%i[</span><span class='tstring_content'>corrected</span><span class='tstring_end'>]</span></span>
          <span class='kw'>end</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<p>This produces a CSV with ~500 rows, with all unique <code>description</code> field values: a much more manageable cleanup project.</p>

<p>The cleanup instructions specify that the client should only edit the <code>corrected</code> field.</p>

<p>If the existing value needs correction, they should enter the correct value in <code>corrected</code>. If the existing value is ok, they should leave <code>corrected</code> blank.</p>

<p><strong>Note:</strong> If there is a need for the client to sort/review the existing and corrected values together as part of the cleanup, I will normally generate an Excel workbook from the worksheet CSV and add a review/sort column with a formula like:</p>

<p><code>=if(isblank(b2),a2,b2)</code></p>

<p>(This assumes original value in column A, corrected in column B)</p>

<h2 id="merging-client-corrections-back-into-migration">Merging client corrections back into migration</h2>

<p>This assumes you have set things up as described in the Produce cleanup worksheet for client section above.</p>

<p>Client returns completed worksheet. If it was provided to them as Excel workbook, convert it back to CSV.</p>

<p>Make a registry entry for this supplied file:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># in clientproject/lib/client/registry_data.rb
</span>
<span class='const'>Client</span><span class='period'>.</span><span class='id identifier rubyid_registry'>registry</span><span class='period'>.</span><span class='id identifier rubyid_namespace'>namespace</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>cleanup_done</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_register'>register</span> <span class='symbol'>:description</span><span class='comma'>,</span> <span class='lbrace'>{</span>
    <span class='label'>path:</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='const'>Client</span><span class='period'>.</span><span class='id identifier rubyid_datadir'>datadir</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>from_client</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>description_cleanup.csv</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='comma'>,</span>
    <span class='label'>supplied:</span> <span class='kw'>true</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span>
</code></pre>

<p>We will also set up a job to keep only the corrections, so our lookup and merge of corrections into the migration can be faster (this gets us neglible gains in most migration projects, but is illustrative...):</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># clientproject/lib/client/jobs/cleanup_prep/description.rb
</span>
<span class='kw'>module</span> <span class='const'>Client</span>
  <span class='kw'>module</span> <span class='const'>Jobs</span>
    <span class='kw'>module</span> <span class='const'>CleanupPrep</span>
      <span class='kw'>module</span> <span class='const'>Description</span>
        <span class='id identifier rubyid_module_function'>module_function</span>

        <span class='kw'>def</span> <span class='id identifier rubyid_job'>job</span>
          <span class='const'><span class='object_link'><a href="Kiba.html" title="Kiba (module)">Kiba</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Kiba/Extend.html" title="Kiba::Extend (module)">Extend</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Kiba/Extend/Jobs.html" title="Kiba::Extend::Jobs (module)">Jobs</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Kiba/Extend/Jobs/Job.html" title="Kiba::Extend::Jobs::Job (class)">Job</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Kiba/Extend/Jobs/BaseJob.html#initialize-instance_method" title="Kiba::Extend::Jobs::BaseJob#initialize (method)">new</a></span></span><span class='lparen'>(</span>
            <span class='label'>files:</span> <span class='lbrace'>{</span>
              <span class='label'>source:</span> <span class='symbol'>:cleanup_done__description</span><span class='comma'>,</span>
              <span class='label'>destination:</span> <span class='symbol'>:cleanup_done__description_prep</span>
            <span class='rbrace'>}</span><span class='comma'>,</span>
            <span class='label'>transformer:</span> <span class='id identifier rubyid_xforms'>xforms</span>
          <span class='rparen'>)</span>
        <span class='kw'>end</span>

        <span class='kw'>def</span> <span class='id identifier rubyid_xforms'>xforms</span>
          <span class='const'><span class='object_link'><a href="Kiba.html" title="Kiba (module)">Kiba</a></span></span><span class='period'>.</span><span class='id identifier rubyid_job_segment'><span class='object_link'><a href="Kiba/Extend/Jobs/JobSegmenter.html#job_segment-instance_method" title="Kiba::Extend::Jobs::JobSegmenter#job_segment (method)">job_segment</a></span></span> <span class='kw'>do</span>
            <span class='id identifier rubyid_transform'>transform</span> <span class='const'>FilterRows</span><span class='op'>::</span><span class='const'>FieldPopulated</span><span class='comma'>,</span>
              <span class='label'>action:</span> <span class='symbol'>:keep</span><span class='comma'>,</span>
              <span class='label'>field:</span> <span class='symbol'>:corrected</span>
          <span class='kw'>end</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<p>Make a registry entry for that job&#39;s output. We are going to want to look up the corrected <code>description</code> value by the original <code>description</code> value, so we record that, if used as a lookup source, the output of the <code>:description_prep</code> job entry will be indexed/looked up on the <code>description</code> field. Our <code>cleanup_done</code> registry namespace now looks like:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># in clientproject/lib/client/registry_data.rb
</span>
<span class='const'>Client</span><span class='period'>.</span><span class='id identifier rubyid_registry'>registry</span><span class='period'>.</span><span class='id identifier rubyid_namespace'>namespace</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>cleanup_done</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_register'>register</span> <span class='symbol'>:description</span><span class='comma'>,</span> <span class='lbrace'>{</span>
    <span class='label'>path:</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='const'>Client</span><span class='period'>.</span><span class='id identifier rubyid_datadir'>datadir</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>from_client</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>description_cleanup.csv</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='comma'>,</span>
    <span class='label'>supplied:</span> <span class='kw'>true</span>
  <span class='rbrace'>}</span>
    <span class='id identifier rubyid_register'>register</span> <span class='symbol'>:description_prep</span><span class='comma'>,</span> <span class='lbrace'>{</span>
    <span class='label'>path:</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='const'>Client</span><span class='period'>.</span><span class='id identifier rubyid_datadir'>datadir</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>working</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>description_cleanup.csv</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='comma'>,</span>
    <span class='label'>creator:</span> <span class='const'>Client</span><span class='op'>::</span><span class='const'>Jobs</span><span class='op'>::</span><span class='const'>CleanupPrep</span><span class='op'>::</span><span class='const'>Description</span><span class='comma'>,</span>
    <span class='label'>lookup_on:</span> <span class='symbol'>:description</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span>
</code></pre>

<p>Finally, create and register a job that merges the corrected data:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Client</span><span class='period'>.</span><span class='id identifier rubyid_registry'>registry</span><span class='period'>.</span><span class='id identifier rubyid_namespace'>namespace</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>cleanup_merge</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_register'>register</span> <span class='symbol'>:field_cleanup</span><span class='comma'>,</span> <span class='lbrace'>{</span>
    <span class='label'>path:</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='const'>Client</span><span class='period'>.</span><span class='id identifier rubyid_datadir'>datadir</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>working</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>cleaned_field_data_merged.csv</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='comma'>,</span>
    <span class='label'>creator:</span> <span class='const'>Client</span><span class='op'>::</span><span class='const'>Jobs</span><span class='op'>::</span><span class='const'>CleanupMerge</span><span class='op'>::</span><span class='const'>FieldCleanup</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span>

<span class='comment'># in clientproject/lib/client/jobs/cleanup_merge/field_cleanup.rb
</span>
<span class='kw'>module</span> <span class='const'>Client</span>
  <span class='kw'>module</span> <span class='const'>Jobs</span>
    <span class='kw'>module</span> <span class='const'>CleanupMerge</span>
      <span class='kw'>module</span> <span class='const'>FieldCleanup</span>
        <span class='id identifier rubyid_module_function'>module_function</span>

        <span class='kw'>def</span> <span class='id identifier rubyid_job'>job</span>
          <span class='const'><span class='object_link'><a href="Kiba.html" title="Kiba (module)">Kiba</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Kiba/Extend.html" title="Kiba::Extend (module)">Extend</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Kiba/Extend/Jobs.html" title="Kiba::Extend::Jobs (module)">Jobs</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Kiba/Extend/Jobs/Job.html" title="Kiba::Extend::Jobs::Job (class)">Job</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Kiba/Extend/Jobs/BaseJob.html#initialize-instance_method" title="Kiba::Extend::Jobs::BaseJob#initialize (method)">new</a></span></span><span class='lparen'>(</span>
            <span class='label'>files:</span> <span class='lbrace'>{</span>
              <span class='label'>source:</span> <span class='symbol'>:base__data</span><span class='comma'>,</span>
              <span class='label'>destination:</span> <span class='symbol'>:cleanup_merge__field_cleanup</span><span class='comma'>,</span>
              <span class='label'>lookup:</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
                         </span><span class='tstring_content'>cleanup_done__description_prep</span><span class='words_sep'>
                         </span><span class='tstring_end'>]</span></span>
            <span class='rbrace'>}</span><span class='comma'>,</span>
            <span class='label'>transformer:</span> <span class='id identifier rubyid_xforms'>xforms</span>
          <span class='rparen'>)</span>
        <span class='kw'>end</span>

        <span class='kw'>def</span> <span class='id identifier rubyid_xforms'>xforms</span>
          <span class='const'><span class='object_link'><a href="Kiba.html" title="Kiba (module)">Kiba</a></span></span><span class='period'>.</span><span class='id identifier rubyid_job_segment'><span class='object_link'><a href="Kiba/Extend/Jobs/JobSegmenter.html#job_segment-instance_method" title="Kiba::Extend::Jobs::JobSegmenter#job_segment (method)">job_segment</a></span></span> <span class='kw'>do</span>
            <span class='qsymbols_beg'>%i[</span><span class='tstring_content'>description</span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_field'>field</span><span class='op'>|</span>
              <span class='id identifier rubyid_corrfield'>corrfield</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_field'>field</span><span class='embexpr_end'>}</span><span class='tstring_content'>_corr</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>

              <span class='id identifier rubyid_transform'>transform</span> <span class='const'>Merge</span><span class='op'>::</span><span class='const'>MultiRowLookup</span><span class='comma'>,</span>
                <span class='label'>lookup:</span> <span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>cleanup_done__cdm1_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_field'>field</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span><span class='comma'>,</span>
                <span class='label'>keycolumn:</span> <span class='id identifier rubyid_field'>field</span><span class='comma'>,</span>
                <span class='label'>fieldmap:</span> <span class='lbrace'>{</span><span class='id identifier rubyid_corrfield'>corrfield</span><span class='op'>=&gt;</span><span class='symbol'>:corrected</span><span class='rbrace'>}</span>

              <span class='id identifier rubyid_transform'>transform</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_row'>row</span><span class='op'>|</span>
                <span class='id identifier rubyid_corrval'>corrval</span> <span class='op'>=</span> <span class='id identifier rubyid_row'>row</span><span class='lbracket'>[</span><span class='id identifier rubyid_corrfield'>corrfield</span><span class='rbracket'>]</span>
                <span class='kw'>next</span> <span class='id identifier rubyid_row'>row</span> <span class='kw'>if</span> <span class='id identifier rubyid_corrval'>corrval</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>

                <span class='id identifier rubyid_row'>row</span><span class='lbracket'>[</span><span class='id identifier rubyid_field'>field</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_corrval'>corrval</span>
                <span class='id identifier rubyid_row'>row</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_transform'>transform</span> <span class='const'>Delete</span><span class='op'>::</span><span class='const'>Fields</span><span class='comma'>,</span> <span class='label'>fields:</span> <span class='id identifier rubyid_corrfield'>corrfield</span>
            <span class='kw'>end</span>
          <span class='kw'>end</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<p>This looks a little weird, but if we later add a date cleanup that follows the same pattern, we can merge that in by making two minor changes:</p>

<pre class="code ruby"><code class="ruby">lookup: %i[
           cleanup_done__description_prep
           ]
</code></pre>

<p>becomes:</p>

<pre class="code ruby"><code class="ruby">lookup: %i[
           cleanup_done__description_prep
           cleanup_done__date_prep
           ]
</code></pre>

<p>And</p>

<pre class="code ruby"><code class="ruby">%i[description].each do |field|
</code></pre>

<p>becomes:</p>

<pre class="code ruby"><code class="ruby">%i[description date].each do |field|
</code></pre>

<p>If you have a number of cleanup jobs like this, which follow the same pattern, you could also <a href="https://lyrasis.github.io/kiba-extend/file.common_patterns_tips_tricks.html#automating-repetitive-file-registry">automate repetitive file registry</a> and create the prep job (and maybe worksheet creation job) as <a href="https://lyrasis.github.io/kiba-extend/file.common_patterns_tips_tricks.html#calling-a-job-with-parameters">jobs that take parameters</a>.</p>
</div></div>

      <div id="footer">
  Generated on Fri Apr 28 21:17:22 2023 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.34 (ruby-2.7.8).
</div>

    </div>
  </body>
</html>